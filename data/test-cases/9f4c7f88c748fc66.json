{"uid":"9f4c7f88c748fc66","name":"test_c2b_auction_full_flow","fullName":"tests.api.mainfunctions.test_auction_flow.TestAuctionFlow#test_c2b_auction_full_flow","historyId":"dd5cde08c15f77b024509ab649360781","time":{"start":1771564433834,"stop":1771564435669,"duration":1835},"status":"failed","statusMessage":"AssertionError: Create offer failed: status=403, body={\"detail\":\"Sizning akkauntingiz bloklangan. Taklif yuborishning iloji yo'q.\"}","statusTrace":"self = <tests.api.mainfunctions.test_auction_flow.TestAuctionFlow object at 0x109b5a590>\napi = <api.api_facade.ApiFacade object at 0x109e8dd10>\n\n    @allure.story(\"Full C2B flow: create → activate → offer → sell\")\n    @allure.severity(allure.severity_level.CRITICAL)\n    @pytest.mark.regression\n    def test_c2b_auction_full_flow(self, api: ApiFacade):\n        # STEP 1: User1 login\n        user1_api = api\n        login_user(phone=\"+998888672005\", code=\"123456\", api=user1_api)\n    \n        # STEP 2: User1 creates self-auction\n        auction_data = create_self_auction(user1_api, AUCTION_PAYLOAD)\n        auction_id = auction_data[\"id\"]\n        allure.attach(\n            str(auction_id),\n            name=\"Created Auction ID\",\n            attachment_type=allure.attachment_type.TEXT\n        )\n    \n        # STEP 3: Admin activates auction\n        from api.api_facade import ApiFacade\n        from utils.config import settings\n        admin_facade = ApiFacade(base_url=settings.BASE_URL)\n        login_admin(username=settings.ADMIN_USERNAME, password=settings.ADMIN_PASSWORD, api=admin_facade)\n    \n        with allure.step(f\"Admin: Activate auction {auction_id} for offer_sending\"):\n            response = admin_facade.moderation.edit_auction(\n                auction_id=auction_id,\n                payload=ADMIN_ACTIVATE_PAYLOAD\n            )\n            assert response.status_code == 200, (\n                f\"Activate failed: {response.status_code} {response.text}\"\n            )\n            assert response.json().get(\"detail\") == \"Partial update successful\"\n    \n        # STEP 4: Business user creates offer\n        bus_api = ApiFacade(base_url=settings.BASE_URL)\n        from steps.auth_steps import login_business\n        login_business(\n            phone=settings.BUS_PHONE,\n            password=settings.BUS_PASSWORD,\n            api=bus_api\n        )\n>       offer_data = create_offer(bus_api, auction_id=auction_id, price=9000.0)\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntests/api/mainfunctions/test_auction_flow.py:141: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\napi = <api.api_facade.ApiFacade object at 0x109f1ab10>, auction_id = 8191\nprice = 9000.0, currency = 'usd'\n\n    def create_offer(api: ApiFacade, auction_id: int, price: float, currency: str = \"usd\") -> dict:\n        \"\"\"Business user creates an offer for auction.\"\"\"\n        with allure.step(f\"Create offer for auction {auction_id}\"):\n            payload = {\"auction\": auction_id, \"price\": price, \"currency\": currency}\n            response = api.business.create_offer_for_business(payload)\n>           assert response.status_code in (200, 201), (\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n                f\"Create offer failed: status={response.status_code}, body={response.text}\"\n            )\nE           AssertionError: Create offer failed: status=403, body={\"detail\":\"Sizning akkauntingiz bloklangan. Taklif yuborishning iloji yo'q.\"}\n\nsteps/auction_steps.py:35: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"api","time":{"start":1771564433833,"stop":1771564433833,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"status":"failed","statusMessage":"AssertionError: Create offer failed: status=403, body={\"detail\":\"Sizning akkauntingiz bloklangan. Taklif yuborishning iloji yo'q.\"}","statusTrace":"self = <tests.api.mainfunctions.test_auction_flow.TestAuctionFlow object at 0x109b5a590>\napi = <api.api_facade.ApiFacade object at 0x109e8dd10>\n\n    @allure.story(\"Full C2B flow: create → activate → offer → sell\")\n    @allure.severity(allure.severity_level.CRITICAL)\n    @pytest.mark.regression\n    def test_c2b_auction_full_flow(self, api: ApiFacade):\n        # STEP 1: User1 login\n        user1_api = api\n        login_user(phone=\"+998888672005\", code=\"123456\", api=user1_api)\n    \n        # STEP 2: User1 creates self-auction\n        auction_data = create_self_auction(user1_api, AUCTION_PAYLOAD)\n        auction_id = auction_data[\"id\"]\n        allure.attach(\n            str(auction_id),\n            name=\"Created Auction ID\",\n            attachment_type=allure.attachment_type.TEXT\n        )\n    \n        # STEP 3: Admin activates auction\n        from api.api_facade import ApiFacade\n        from utils.config import settings\n        admin_facade = ApiFacade(base_url=settings.BASE_URL)\n        login_admin(username=settings.ADMIN_USERNAME, password=settings.ADMIN_PASSWORD, api=admin_facade)\n    \n        with allure.step(f\"Admin: Activate auction {auction_id} for offer_sending\"):\n            response = admin_facade.moderation.edit_auction(\n                auction_id=auction_id,\n                payload=ADMIN_ACTIVATE_PAYLOAD\n            )\n            assert response.status_code == 200, (\n                f\"Activate failed: {response.status_code} {response.text}\"\n            )\n            assert response.json().get(\"detail\") == \"Partial update successful\"\n    \n        # STEP 4: Business user creates offer\n        bus_api = ApiFacade(base_url=settings.BASE_URL)\n        from steps.auth_steps import login_business\n        login_business(\n            phone=settings.BUS_PHONE,\n            password=settings.BUS_PASSWORD,\n            api=bus_api\n        )\n>       offer_data = create_offer(bus_api, auction_id=auction_id, price=9000.0)\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntests/api/mainfunctions/test_auction_flow.py:141: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\napi = <api.api_facade.ApiFacade object at 0x109f1ab10>, auction_id = 8191\nprice = 9000.0, currency = 'usd'\n\n    def create_offer(api: ApiFacade, auction_id: int, price: float, currency: str = \"usd\") -> dict:\n        \"\"\"Business user creates an offer for auction.\"\"\"\n        with allure.step(f\"Create offer for auction {auction_id}\"):\n            payload = {\"auction\": auction_id, \"price\": price, \"currency\": currency}\n            response = api.business.create_offer_for_business(payload)\n>           assert response.status_code in (200, 201), (\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n                f\"Create offer failed: status={response.status_code}, body={response.text}\"\n            )\nE           AssertionError: Create offer failed: status=403, body={\"detail\":\"Sizning akkauntingiz bloklangan. Taklif yuborishning iloji yo'q.\"}\n\nsteps/auction_steps.py:35: AssertionError","steps":[{"name":"Login user: phone=+998888672005","time":{"start":1771564433834,"stop":1771564433906,"duration":72},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Create self-auction","time":{"start":1771564433907,"stop":1771564434182,"duration":275},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Login admin: username=supermoderator","time":{"start":1771564434183,"stop":1771564434607,"duration":424},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Admin: Activate auction 8191 for offer_sending","time":{"start":1771564434607,"stop":1771564435212,"duration":605},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Login business user: phone=+998888672005","time":{"start":1771564435212,"stop":1771564435624,"duration":412},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Create offer for auction 8191","time":{"start":1771564435624,"stop":1771564435667,"duration":43},"status":"failed","statusMessage":"AssertionError: Create offer failed: status=403, body={\"detail\":\"Sizning akkauntingiz bloklangan. Taklif yuborishning iloji yo'q.\"}\n","statusTrace":"  File \"/Users/user/Downloads/abozor-api-tests/steps/auction_steps.py\", line 35, in create_offer\n    assert response.status_code in (200, 201), (\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"attachmentsCount":0,"stepsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[{"uid":"32cf398fbe5f690a","name":"Created Auction ID","source":"32cf398fbe5f690a.txt","type":"text/plain","size":4}],"parameters":[],"shouldDisplayMessage":true,"attachmentsCount":1,"stepsCount":6,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"feature","value":"C2B Auction End-to-End"},{"name":"story","value":"Full C2B flow: create → activate → offer → sell"},{"name":"epic","value":"Auction"},{"name":"severity","value":"critical"},{"name":"tag","value":"regression"},{"name":"parentSuite","value":"tests.api.mainfunctions"},{"name":"suite","value":"test_auction_flow"},{"name":"subSuite","value":"TestAuctionFlow"},{"name":"host","value":"Mac"},{"name":"thread","value":"4679-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.api.mainfunctions.test_auction_flow"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"critical","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[]}],"tags":["regression"]},"source":"9f4c7f88c748fc66.json","parameterValues":[]}